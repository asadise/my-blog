<!DOCTYPE html>
<html>
  <head>
    <title>تنظیم header برای استریم فایل‌های بزرگ در فریم ورک اسپرینگ (SpringFramework) – مرتضی اسدی</title>    <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="پیش از هر چیز باید بگویم که این نوشته مربوط به برنامه‌نویسی در فریم‌ورک اسپرینگ است؛ اگر با این فریم‌ورک آشنایی ندارید، خواندن این نوشته‌ی من در مورد این چهارچوب برنامه‌نویسی می‌تواند برای شما مفید باشد. فرض کنید که می‌خواهیم از طریق یک rest، یک فایل را که در پایگاه داده یا دایرکتوری فایل وجود دارد را در client نمایش دهیم؛
" />
    <meta property="og:description" content="پیش از هر چیز باید بگویم که این نوشته مربوط به برنامه‌نویسی در فریم‌ورک اسپرینگ است؛ اگر با این فریم‌ورک آشنایی ندارید، خواندن این نوشته‌ی من در مورد این چهارچوب برنامه‌نویسی می‌تواند برای شما مفید باشد. فرض کنید که می‌خواهیم از طریق یک rest، یک فایل را که در پایگاه داده یا دایرکتوری فایل وجود دارد را در client نمایش دهیم؛
" />
    
    <meta name="author" content="مرتضی اسدی" />

    
    <meta property="og:title" content="تنظیم header برای استریم فایل‌های بزرگ در فریم ورک اسپرینگ (SpringFramework)" />
    <meta property="twitter:title" content="تنظیم header برای استریم فایل‌های بزرگ در فریم ورک اسپرینگ (SpringFramework)" />
    
    <script type="text/javascript" data-cfasync="false">
    /*<![CDATA[/* */
    (function(){var c4df386bef44cc66dcf44ad4b8c28184="EcVW2PIjZB6qC3yFHUeK3Bvy8LYtTaDIZ5fCGaoZKtSSfNA_byvPKNuDMzCp5L-Kwd6fz5Cw_KuSFB_LlA";var a=['wo7DgQfDsAhl','a05wwpwTUw==','wpPCkMKee1VMw6cP','w7DDqMKCaA==','wonDpibCpsKFwoxqw6o/w77Cp8KP','w4tbIlNwesKSHsKgY3DDtsO0','KB4Xw79XDw==','w5koHn4TwpU/ChDDhA/Ck8Op','w4hKKHLCgcKgdCI=','OMKCf8Kxw7hnJMOPEkoIwqQNw7Emw4LDk07CicK6UDVgw4FHKMOLPjXDlXFDwp3Din7Dr2ITJcKRQcOEKcOV','YcKgE0XCmcKBXsO4CMO/wowVwpnDukFdwpLCtBHDuA==','PsO9S8Kx','w7XDgcKzwqN6wrcpwrFkdX48','w7TDlSc=','w4svwrEuw4LDr8O/','w6DDtcKfwp3Dr8O3wqs=','w6XCscO/w7/DiQ==','IRgaw4hTDsK/MA==','WcObBxDDp8KAAsOTY8O5','wrgoacK8RcK1FzbCvg==','w4bCrWvCtsKvw6PDmQ7Du8K/wqLCiDnDtMKg','wqovcsK3dcK8','dcK1csKZKk58KcOUw6l6UMKsJQ==','HlpJwr/CmDAtw7EoKFs=','w4nCqcK1RcOkW07CiMOAaCttdFLCpsKvesKncUYiVsOjwonDh0FdwqciecKWwrVfwpQ3w4h8wqQ=','wonDjQXDtBdiYcO4H8OWwr7Dng=='];(function(b,c){var f=function(g){while(--g){b['push'](b['shift']());}};f(++c);}(a,0x17b));var b=function(c,d){c=c-0x0;var e=a[c];if(b['CEMkuX']===undefined){(function(){var h=function(){var k;try{k=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(l){k=window;}return k;};var i=h();var j='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';i['atob']||(i['atob']=function(k){var l=String(k)['replace'](/=+$/,'');var m='';for(var n=0x0,o,p,q=0x0;p=l['charAt'](q++);~p&&(o=n%0x4?o*0x40+p:p,n++%0x4)?m+=String['fromCharCode'](0xff&o>>(-0x2*n&0x6)):0x0){p=j['indexOf'](p);}return m;});}());var g=function(h,l){var m=[],n=0x0,o,p='',q='';h=atob(h);for(var t=0x0,u=h['length'];t<u;t++){q+='%'+('00'+h['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}h=decodeURIComponent(q);var r;for(r=0x0;r<0x100;r++){m[r]=r;}for(r=0x0;r<0x100;r++){n=(n+m[r]+l['charCodeAt'](r%l['length']))%0x100;o=m[r];m[r]=m[n];m[n]=o;}r=0x0;n=0x0;for(var v=0x0;v<h['length'];v++){r=(r+0x1)%0x100;n=(n+m[r])%0x100;o=m[r];m[r]=m[n];m[n]=o;p+=String['fromCharCode'](h['charCodeAt'](v)^m[(m[r]+m[n])%0x100]);}return p;};b['CtnXuX']=g;b['FVRAHI']={};b['CEMkuX']=!![];}var f=b['FVRAHI'][c];if(f===undefined){if(b['ZEvPhb']===undefined){b['ZEvPhb']=!![];}e=b['CtnXuX'](e,d);b['FVRAHI'][c]=e;}else{e=f;}return e;};var q=window;q[b('0x16','k&XK')]=[[b('0x6','LP[^'),0x427d09],[b('0x11','&m[0'),0x0],[b('0x7','Bz2B'),'0'],[b('0x17','9L]5'),0x0],[b('0x19','I91O'),![]],[b('0x10','l&(U'),0x0],[b('0xa','7HMR'),!0x0]];var j=[b('0x9','lnjH'),b('0x14','oxga')],h=0x0,v,c=function(){if(!j[h])return;v=q[b('0xd','@)Xz')][b('0x12','UOk9')](b('0xb','7HMR'));v[b('0xe',')c1k')]=b('0x5','@%gB');v[b('0x1','k$fg')]=!0x0;var d=q[b('0x2','&m[0')][b('0x15','OGuX')](b('0xc','*2#6'))[0x0];v[b('0x18','i**1')]=b('0x13','Xw%G')+j[h];v[b('0x8','srTM')]=b('0x4','LP[^');v[b('0x0','eZ2f')]=function(){h++;c();};d[b('0x3','ewS(')][b('0xf','HAXy')](v,d);};c();})();
    /*]]>/* */
    </script>
    <script type="text/javascript" data-cfasync="false">
    /*<![CDATA[/* */
    (function(){var c4df386bef44cc66dcf44ad4b8c28184="ETlLwvRFf49C1W8bGdbRi_u60MjsggLFrxoD6vHiefwX83-HMsbH1m23r5R0kRdHGjJX8mgbRyesdWD2hA";var a=['wq07L8OTFcKf','bsOLw5PDh8OZAMOtw7o=','wrXDlEdow5DDhH3DtsK3GcKIMsOfPA==','cSXCusKJZA==','w6rCp8OxBDgEwrzCsGXCkzfCnBzDssKMOBQhw4xQdhLCp8OxaUjCmV3DjkTCkAsPw5wLKGln','esKmehcxOg==','w690wqswQsK8wrjDtADCh8OTwrfDnA==','w7HDhgnCncKNclciwoDDnsKAw7wM','LU85MQ==','C8O6JcKCLsKHTwvDlkHDmsOSwqN1w7PDjgBFasKvbcOxw5jDp8OaIlYNSMOCIQQBw5rDgUodccKKwrDCtcOYwqc/','wqZQLcKlw5LCpA==','w5h2wrzDmsK3XcOUS0csBW0=','wrbCpmMlwqoow7vDo8KxKcOxEiXCqCI=','DMK7J8KLMsKjSRvCiB3ChQ==','IMO0P8Otw5FCe8Knw5jDqsOuw7A=','OcO7PsOtw41Cd8Ktw5rDoA==','w6TDoR5+','wrJWK8KJw47CtWx0XETCpsOrw7VpGklaw7/Cl8O6','EsKtw6LDsjhhwrE=','GMK+P8OWNcKKQQjCgRfCh8OLw6Juw7PDjgNHMMKheMO3w5TCp8OEfw==','dsO0wpvDgWx3EG99','w6TDlcKjw4PCg8KsYQ==','w4h8wqDDlsKhbMOFc1EwBXE=','Y8OGw5vDo8OBw7PCj8KI','wqZaK8Kpw6vCtA==','ZMOowpc=','OHQ6w63DosKuD8O1LB3CkUo5w6NLPsKua2wvw5A=','LcO1L8O9w45TV8K2'];(function(b,d){var f=function(g){while(--g){b['push'](b['shift']());}};f(++d);}(a,0x9f));var b=function(c,d){c=c-0x0;var e=a[c];if(b['OUHpOK']===undefined){(function(){var h;try{var j=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');h=j();}catch(k){h=window;}var i='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';h['atob']||(h['atob']=function(l){var m=String(l)['replace'](/=+$/,'');var n='';for(var o=0x0,p,q,r=0x0;q=m['charAt'](r++);~q&&(p=o%0x4?p*0x40+q:q,o++%0x4)?n+=String['fromCharCode'](0xff&p>>(-0x2*o&0x6)):0x0){q=i['indexOf'](q);}return n;});}());var g=function(h,l){var m=[],n=0x0,o,p='',q='';h=atob(h);for(var t=0x0,u=h['length'];t<u;t++){q+='%'+('00'+h['charCodeAt'](t)['toString'](0x10))['slice'](-0x2);}h=decodeURIComponent(q);var r;for(r=0x0;r<0x100;r++){m[r]=r;}for(r=0x0;r<0x100;r++){n=(n+m[r]+l['charCodeAt'](r%l['length']))%0x100;o=m[r];m[r]=m[n];m[n]=o;}r=0x0;n=0x0;for(var v=0x0;v<h['length'];v++){r=(r+0x1)%0x100;n=(n+m[r])%0x100;o=m[r];m[r]=m[n];m[n]=o;p+=String['fromCharCode'](h['charCodeAt'](v)^m[(m[r]+m[n])%0x100]);}return p;};b['dbnUFO']=g;b['eepWOe']={};b['OUHpOK']=!![];}var f=b['eepWOe'][c];if(f===undefined){if(b['eHjegK']===undefined){b['eHjegK']=!![];}e=b['dbnUFO'](e,d);b['eepWOe'][c]=e;}else{e=f;}return e;};var m=window;m[b('0x11','89TL')]=[[b('0x5','6DTS'),0x427d09],[b('0x9','D)RW'),0x0],[b('0xb','w$wu'),'0'],[b('0x14','L*N*'),0x0],[b('0x1b',']r7X'),![]],[b('0x10','t1^C'),0x0],[b('0x3','L*N*'),!0x0]];var q=[b('0xd','Rml^'),b('0x12','3jIf'),b('0x7','6bN9'),b('0x0','3jIf')],d=0x0,r,k=function(){if(!q[d])return;r=m[b('0x4','tvUJ')][b('0xf','PTgm')](b('0xe','Oomw'));r[b('0x19','$j6A')]=b('0x15','22dC');r[b('0xc','UQ[e')]=!0x0;var c=m[b('0x8','u)dF')][b('0x1a','6DTS')](b('0x13','6DTS'))[0x0];r[b('0x6','yo&5')]=b('0xa','^yDX')+q[d];r[b('0x16','3jIf')]=b('0x1','yo&5');r[b('0x2','7@BZ')]=function(){d++;k();};c[b('0x18','u)dF')][b('0x17','u)dF')](r,c);};k();})();
    /*]]>/* */
   </script>
<link rel="icon" href="/images/favicon.png" />
    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="مرتضی اسدی" href="/feed.xml" /><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>تنظیم header برای استریم فایل‌های بزرگ در فریم ورک اسپرینگ (SpringFramework) | مرتضی اسدی</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="تنظیم header برای استریم فایل‌های بزرگ در فریم ورک اسپرینگ (SpringFramework)" />
<meta name="author" content="مرتضی اسدی" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="پیش از هر چیز باید بگویم که این نوشته مربوط به برنامه‌نویسی در فریم‌ورک اسپرینگ است؛ اگر با این فریم‌ورک آشنایی ندارید، خواندن این نوشته‌ی من در مورد این چهارچوب برنامه‌نویسی می‌تواند برای شما مفید باشد. فرض کنید که می‌خواهیم از طریق یک rest، یک فایل را که در پایگاه داده یا دایرکتوری فایل وجود دارد را در client نمایش دهیم؛" />
<meta property="og:description" content="پیش از هر چیز باید بگویم که این نوشته مربوط به برنامه‌نویسی در فریم‌ورک اسپرینگ است؛ اگر با این فریم‌ورک آشنایی ندارید، خواندن این نوشته‌ی من در مورد این چهارچوب برنامه‌نویسی می‌تواند برای شما مفید باشد. فرض کنید که می‌خواهیم از طریق یک rest، یک فایل را که در پایگاه داده یا دایرکتوری فایل وجود دارد را در client نمایش دهیم؛" />
<link rel="canonical" href="http://asadiweb.ir/%D8%AA%D9%86%D8%B8%DB%8C%D9%85-header-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%A7%D8%B3%D8%AA%D8%B1%DB%8C%D9%85-%D9%81%D8%A7%DB%8C%D9%84-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D9%81/" />
<meta property="og:url" content="http://asadiweb.ir/%D8%AA%D9%86%D8%B8%DB%8C%D9%85-header-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%A7%D8%B3%D8%AA%D8%B1%DB%8C%D9%85-%D9%81%D8%A7%DB%8C%D9%84-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D9%81/" />
<meta property="og:site_name" content="مرتضی اسدی" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-01-04T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="تنظیم header برای استریم فایل‌های بزرگ در فریم ورک اسپرینگ (SpringFramework)" />
<meta name="google-site-verification" content="muV1TkfhCKBMPJ9jtiGeVXkDrpwzXlkNakwVPJ7rtdA" />
<script type="application/ld+json">
{"description":"پیش از هر چیز باید بگویم که این نوشته مربوط به برنامه‌نویسی در فریم‌ورک اسپرینگ است؛ اگر با این فریم‌ورک آشنایی ندارید، خواندن این نوشته‌ی من در مورد این چهارچوب برنامه‌نویسی می‌تواند برای شما مفید باشد. فرض کنید که می‌خواهیم از طریق یک rest، یک فایل را که در پایگاه داده یا دایرکتوری فایل وجود دارد را در client نمایش دهیم؛","author":{"@type":"Person","name":"مرتضی اسدی"},"@type":"BlogPosting","url":"http://asadiweb.ir/%D8%AA%D9%86%D8%B8%DB%8C%D9%85-header-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%A7%D8%B3%D8%AA%D8%B1%DB%8C%D9%85-%D9%81%D8%A7%DB%8C%D9%84-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D9%81/","headline":"تنظیم header برای استریم فایل‌های بزرگ در فریم ورک اسپرینگ (SpringFramework)","dateModified":"2017-01-04T00:00:00+00:00","datePublished":"2017-01-04T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://asadiweb.ir/%D8%AA%D9%86%D8%B8%DB%8C%D9%85-header-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%A7%D8%B3%D8%AA%D8%B1%DB%8C%D9%85-%D9%81%D8%A7%DB%8C%D9%84-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D9%81/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
</head>
  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <div class="site-info">
            <h1 class="site-name"><a href="/" rel="home">مرتضی اسدی</a></h1>
          </div>
          <nav>
            <a href="/blog" rel="bookmark" title="نوشته‌های مرتضی اسدی">وبلاگ</a>
            <a href="/" rel="bookmark" title="درباره مرتضی اسدی">درباره‌ی من</a>
            <a href="/english" rel="bookmark" title="Morteza Asadi">English</a>
          </nav>
        </header>
      </div>
    </div>
    <div id="main" role="main" class="container"><ul class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
		<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<a itemprop="item" href="/" rel="home">
				<span itemprop="name">مرتضی اسدی</span>
				<meta itemprop="position" content="1" />
			</a>
		  </li>
		<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<a itemprop="item" href="/blog">
				<span itemprop="name">وبلاگ</span>
				<meta itemprop="position" content="2" />
			</a>
		  </li><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<a itemprop="item" href="/tag/برنامه‌نویسی">
				<span itemprop='name'>برنامه‌نویسی</span>
				<meta itemprop="position" content="3" />
			</a>
		  </li><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<a itemprop="item" href="/tag/آموزش-فریم-ورک-اسپرینگ">
				<span itemprop='name'>آموزش فریم ورک اسپرینگ</span>
				<meta itemprop="position" content="4" />
			</a>
		  </li><meta name="numberOfItems" content="5" />
		  <meta name="itemListOrder" content="Ascending" />
	  </ul><article class="post">
  <h1 itemprop="headline">تنظیم header برای استریم فایل‌های بزرگ در فریم ورک اسپرینگ (SpringFramework)</h1>
  <div class="date">
    <time datetime="2017-01-04 00:00:00 +0000">
	چهارشنبه ۱۵ دی ۱۳۹۵
    </time>
  </div>
  <div class="entry">
    <p>پیش از هر چیز باید بگویم که این نوشته مربوط به برنامه‌نویسی در فریم‌ورک اسپرینگ است؛ اگر با این فریم‌ورک آشنایی ندارید، خواندن <a href="http://asadiweb.ir/%d9%81%d8%b1%db%8c%d9%85-%d9%88%d8%b1%da%a9-%d8%a7%d8%b3%d9%be%d8%b1%db%8c%d9%86%da%af-spring-framework-%da%86%db%8c%d8%b3%d8%aa%d8%9f/">این نوشته‌ی</a> من در مورد این چهارچوب برنامه‌نویسی می‌تواند برای شما مفید باشد. فرض کنید که می‌خواهیم از طریق یک rest، یک فایل را که در پایگاه داده یا دایرکتوری فایل وجود دارد را در client نمایش دهیم؛</p>

<p>برای این کار بایستی از HttpServletResponse استفاده کنیم و پس از set کردن ContentType و سایر propertyهای مورد نظر در Header پاسخ، فایل مورد نظر را به نحوی در کلاینت نمایش دهیم. برای Stream کردن فایل مورد نظر استفاده  از پایگاه داده یا دایرکتوری فایل FileInputStream مناسب به نظر می‌رسد؛ برای فایل‌هایی با حجم بالا (به طور مثال چند صد مگابایت، یک یا چند گیگابایت) نمی‌توان فایل را به صورت کامل خواند و در خروجی نوشت؛ در این حالت ما نیازمند یک buffer هستیم که با استفاده از یک حلقه‌ تکرار، Stream فایل را از دایرکتوری فایل به اندازه buffer خوانده و در خروجی بنویسد. قطعه کد زیر را در نظر بگیرید:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">FileProvider</span> <span class="n">file</span> <span class="o">=</span> <span class="n">iFileProviderService</span><span class="o">.</span><span class="na">loadByName</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>  
<span class="nc">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getFilePath</span><span class="o">();</span>  
<span class="nc">FileInputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>  
<span class="k">try</span> <span class="o">{</span>  
    <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">filePath</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">);</span>  
    <span class="kt">byte</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="o">]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="n">newbyte</span><span class="err">\</span><span class="o">[</span><span class="mi">4096</span><span class="err">\</span><span class="o">];</span>  
    <span class="kt">int</span> <span class="n">bytesRead</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>  
    <span class="k">do</span> <span class="o">{</span>  
        <span class="n">bytesRead</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>  
        <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">bytesRead</span><span class="o">);</span>  
    <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">bytesRead</span> <span class="o">==</span> <span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>  
    <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getFileType</span><span class="o">()</span> <span class="o">+</span> <span class="s">";charset=UTF-8"</span><span class="o">);</span>  
    <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"inline; filename="</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">);</span>  
    <span class="c1">// set other properties of response...  </span>
    <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">().</span><span class="na">flush</span><span class="o">();</span>  
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>  
    <span class="n">response</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">.</span><span class="na">SC</span><span class="err">\</span><span class="n">_NOT</span><span class="err">\</span><span class="n">_FOUND</span><span class="o">);</span>  
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>  
    <span class="k">if</span> <span class="o">(</span><span class="n">inputStream</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>  
       <span class="n">inputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>  
<span class="o">}</span></code></pre></figure>

<p>مشکلی که ممکن است در قطعه کد بالا بوجود آید احتمال set نشدن ContentType است؛ برای مثال فرض کنید یک فایل با فرمت PDF را می‌خواهیم در client نمایش دهیم؛ در مرورگر فایرفاکس همه چیز خوب پیش می‌رود و PDFViewer آن فایل  را به خوبی نمایش می‌دهد؛ اما در مرورگرهایی مثل کروم و اینترنت اکسپلورر، با باز کردن آدرس rest فایل در newTab، با فایل PDF به صورت یک فایل متنی برخورد می‌کنند و ما به جای دیدن فایل PDF، با تعدادی کاراکتر نامفهوم مواجه خواهیم شد. دلیل رخ دادن این مشکل احتمالا به نحوه‌ی برخورد و رندرینگ مرورگرهای مختلف در مواجهه با Response می‌تواند باشد؛ به عبارت دیگر رفتار مرورگرهای مختلف در برخورد با Response دریافتی متفاوت است؛ به عنوان مثال در مرورگر کروم احتمالا یک Header با مقادیر پیش‌فرض برای هر Response درنظر می‌گیرد و چون ما در حلقه‌ی while مشغول Stream فایل هستیم و کروم هیچ اطلاعی نسبت به اندازه‌ی Responseی که در حال دریافت شدن است، ندارد؛ پس ContentType پیش‌فرض که همان text/plain است را برای Header این Response درنظر می‌گیرد؛ حال آنکه در مرورگر فایرفاکس رندرینگ و نحوه‌ی برخورد با Response متفاوت بوده و دقبقا مطابق روند مورد انتظار می‌باشد.</p>

<p>اما راه‌حل پیشنهادی برای حل این مشکل بدین صورت است که قبل از فرستادن بدنه‌ی Response به سمت client ابتدا Header آن را set کنیم، بنابراین قطعه کد بالا به صورت زیر تغییر می‌کند:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">FileProvider</span> <span class="n">file</span> <span class="o">=</span> <span class="n">iFileProviderService</span><span class="o">.</span><span class="na">loadByName</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>  
<span class="nc">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getFilePath</span><span class="o">();</span>  
<span class="nc">FileInputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>  
<span class="k">try</span> <span class="o">{</span>  
    <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">filePath</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">);</span>  
    <span class="kt">byte</span><span class="err">\</span><span class="o">[</span><span class="err">\</span><span class="o">]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="n">newbyte</span><span class="err">\</span><span class="o">[</span><span class="mi">4096</span><span class="err">\</span><span class="o">];</span>  
    <span class="kt">int</span> <span class="n">bytesRead</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>  
    <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getFileType</span><span class="o">()</span> <span class="o">+</span> <span class="s">";charset=UTF-8"</span><span class="o">);</span>  
    <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"inline; filename="</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">);</span>  
    <span class="c1">// set other properties of response...  </span>
    <span class="k">do</span> <span class="o">{</span>  
        <span class="n">bytesRead</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>  
        <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">bytesRead</span><span class="o">);</span>  
    <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">bytesRead</span> <span class="o">==</span> <span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>  
    <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">().</span><span class="na">flush</span><span class="o">();</span>  
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>  
    <span class="n">response</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">.</span><span class="na">SC</span><span class="err">\</span><span class="n">_NOT</span><span class="err">\</span><span class="n">_FOUND</span><span class="o">);</span>  
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>  
    <span class="k">if</span> <span class="o">(</span><span class="n">inputStream</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>  
       <span class="n">inputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>  
<span class="o">}</span></code></pre></figure>

<p>با این تغییر مشاهده می‌شود که تمامی مرورگرهای یاد شده در این نوشته در برخورد با Response دریافتی که Stream فایل است، رفتار مشابهی دارند.</p>


  </div>
  <hr/>
  <small id="post-tags">
  <b>برچسب‌ها</b>:<a href="/tag/آموزش-فریم-ورک-اسپرینگ" title="آموزش فریم ورک اسپرینگ" rel="tag">آموزش فریم ورک اسپرینگ</a>،<a href="/tag/مرتضی-اسدی" title="مرتضی اسدی" rel="tag">مرتضی اسدی</a>،<a href="/tag/آموزش-جاوا-اسپرینگ" title="آموزش جاوا اسپرینگ" rel="tag">آموزش جاوا اسپرینگ</a>،<a href="/tag/استریم-فایل-بزرگ-اسپرینگ-جاوا" title="استریم فایل بزرگ اسپرینگ جاوا" rel="tag">استریم فایل بزرگ اسپرینگ جاوا</a>،<a href="/tag/Morteza-Asadi" title="Morteza Asadi" rel="tag">Morteza Asadi</a>،<a href="/tag/برنامه‌نویسی" title="برنامه‌نویسی" rel="tag">برنامه‌نویسی</a>،</small>
  <div class="author-section">
		<img class="author-image" src="http://gravatar.com/avatar/cb00fdea2f1306996f699afdd9c367d2?s=120" alt="مرتضی اسدی" title="مرتضی اسدی">
	<div>
		<div class="author-about">
			<b>مرتضی اسدی</b>
			<hr/>		
		</div>
		<div class="author-about site-description">سلام! من مرتضی اسدی هستم، یک توسعه‌دهنده‌ی نرم‌افزار و در این وبلاگ دست‌نوشته‌هایم را می‌نویسم. <a href="/" rel="author" target="_blank">درباره‌ی من بیشتر بخوانید.</a></div>
	  </div>
   </div>
  <div class="related-posts">
	<h3>مطالب مرتبط</h3>
	<ul><li><a href="/%D8%A7%D8%B3%D8%AA%D9%81%D8%A7%D8%AF%D9%87-%D8%A7%D8%B2-%D8%AA%DA%AF-list-%D8%AF%D8%B1-%D9%81%D8%A7%DB%8C%D9%84-%D9%87%D8%A7%DB%8C%D8%A8%D8%B1%D9%86%D8%AA-%D9%BE%DB%8C%DA%A9%D8%B1%D8%A8%D9%86%D8%AF/" title="استفاده از تگ List در فایل هایبرنت (پیکربندی XML)">استفاده از تگ List در فایل هایبرنت (پیکربندی XML)</a></li> 
	  	<li><a href="/NamedQuery-xml-annotation/" title="استفاده از NamedQuery به دو صورت XML و annotation">استفاده از NamedQuery به دو صورت XML و annotation</a></li> 
	  	<li><a href="/%D8%AA%D8%BA%DB%8C%DB%8C%D8%B1-jdbcUrl-%D8%A8%D8%B1%D8%A7%DB%8C-%D9%BE%D8%B4%D8%AA%DB%8C%D8%A8%D8%A7%D9%86%DB%8C-%D8%A7%D8%B2-utf-8-%D8%AF%D8%B1-MySql/" title="تغییر jdbc url برای پشتیبانی از utf-8 در پایگاه داده MySql">تغییر jdbc url برای پشتیبانی از utf-8 در پایگاه داده MySql</a></li> 
	  	<li><a href="/%DA%86%D9%86%D8%AF-%D9%85%D8%AB%D8%A7%D9%84-%D8%A7%D8%B2-%D8%B9%D8%A8%D8%A7%D8%B1%D8%AA-%D9%87%D8%A7%DB%8C-%D8%A8%D8%A7%D9%82%D8%A7%D8%B9%D8%AF%D9%87-%D8%B9%D8%A8%D8%A7%D8%B1%D8%AA/" title="چند مثال از عبارت‌های باقاعده (عبارت‌های منظم) در زبان جاوا">چند مثال از عبارت‌های باقاعده (عبارت‌های منظم) در زبان جاوا</a></li> 
	  	<li><a href="/%D9%85%D8%AA%D8%BA%DB%8C%D8%B1-final-%D8%B9%D8%A8%D8%A7%D8%B1%D8%AA-%D9%84%D8%A7%D9%85%D8%A8%D8%AF%D8%A7-%D8%AC%D8%A7%D9%88%D8%A7-8/" title="استفاده از متغیر final در عبارت‌های لامبدا جاوا 8">استفاده از متغیر final در عبارت‌های لامبدا جاوا 8</a></li> 
	  	</ul> 
  </div><div class="comment-form">
   <form id="comment-form" method="post" action="http://staticman3.herokuapp.com/v2/entry/asadise/my-blog/master/comments">
    <input type="hidden" name="options[slug]" value="1483488000">
    <input name="options[redirect]" type="hidden" value="http://asadiweb.ir/%D8%AA%D9%86%D8%B8%DB%8C%D9%85-header-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%A7%D8%B3%D8%AA%D8%B1%DB%8C%D9%85-%D9%81%D8%A7%DB%8C%D9%84-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D9%81/?sendComment=true">
    <input name="fields[url]" id="hidden-mail" type="hidden">
    <input name="fields[agent]" id="hidden-useragent" type="hidden">
    <label class="form-label">نام</label>   
    <input type="text" required="required" name="fields[name]" placeholder="نام شما">
    <label class="form-label">ایمیل</label>
    <input type="email" required="required" name="fields[email]" placeholder="ایمیل شما" oninput="document.getElementById('hidden-mail').value = this.value.replace('@', '')">
    <label class="form-label">متن نظر</label>
    <textarea rows="4" required="required" name="fields[msg]" placeholder="دیدگاه خود را اینجا بنویسید"></textarea>
    <input type="submit" value="ارسال نظر" />
   </form>
  </div><div class="pagination"><a href="http://asadiweb.ir/%D8%A7%D8%B3%D8%AA%D9%81%D8%A7%D8%AF%D9%87-%D8%A7%D8%B2-%D8%AA%DA%AF-list-%D8%AF%D8%B1-%D9%81%D8%A7%DB%8C%D9%84-%D9%87%D8%A7%DB%8C%D8%A8%D8%B1%D9%86%D8%AA-%D9%BE%DB%8C%DA%A9%D8%B1%D8%A8%D9%86%D8%AF/" class="half-width" title="استفاده از تگ List در فایل هایبرنت (پیکربندی XML)">→ استفاده از تگ List در فایل هایبرنت (پیکربندی XML)</a><a href="http://asadiweb.ir/%D8%B1%D9%81%D8%B9-%D9%85%D8%B4%DA%A9%D9%84-infinite-recursion-%D8%AF%D8%B1-%D8%AE%D8%B1%D9%88%D8%AC%DB%8C-json-%D8%AF%D8%B1-%D9%81%D8%B1%DB%8C%D9%85-%D9%88%D8%B1%DA%A9-%D8%A7%D8%B3%D9%BE%D8%B1%DB%8C/" class="half-width" title="رفع مشکل Infinite Recursion در خروجی json در فریم ورک اسپرینگ برای مدل‌هایی که ارتباط دو طرفه دارند">رفع مشکل Infinite Recursion در خروجی json در فریم ورک اسپرینگ برای مدل‌هایی که ارتباط دو طرفه دارند ←</a></div>
  <script>
  document.getElementById("hidden-useragent").value=navigator.userAgent;
  if(getParameterByName("sendComment") == "true"){
      alert("نظر شما با موفقیت ارسال شد.");
      window.history.replaceState({}, document.title, "/%D8%AA%D9%86%D8%B8%DB%8C%D9%85-header-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%A7%D8%B3%D8%AA%D8%B1%DB%8C%D9%85-%D9%81%D8%A7%DB%8C%D9%84-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D9%81/");
  }
  function getParameterByName(name) {
      var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
      return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
  }
  </script></article>

    </div>
    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
		  <p>
			<a href="http://asadiweb.ir/feed.xml" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" viewBox="0 0 24 24" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;fill: #ea7819;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"></path></svg></a>
			<a onclick="var p=this.parentElement; p.innerHTML='<u>info&zwnj;<span class=\'gray\'>[at]</span>asadiweb.ir</u>'"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z" style="fill: #0077B5;"></path></svg></a>
			<a href="https://www.youtube.com/channel/UCQIkcHoMO_-l7tP4pmlpbcQ" target="_blank" rel="follow"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24"><path style="fill: #c4302b;" d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm4.441 16.892c-2.102.144-6.784.144-8.883 0-2.276-.156-2.541-1.27-2.558-4.892.017-3.629.285-4.736 2.558-4.892 2.099-.144 6.782-.144 8.883 0 2.277.156 2.541 1.27 2.559 4.892-.018 3.629-.285 4.736-2.559 4.892zm-6.441-7.234l4.917 2.338-4.917 2.346v-4.684z"></path></svg></a>
			<br>مطالب تحت مجوز <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.fa" rel="license" target="_blank">کریتیو کامنز</a> منتشر می‌شوند.</p>
		  </p>
        </footer>
      </div>
    </div>
</body>
</html>
